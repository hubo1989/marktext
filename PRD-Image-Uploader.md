# äº§å“éœ€æ±‚æ–‡æ¡£ (PRD) - å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½å‡çº§

## 1. äº§å“æ¦‚è¿°

### 1.1 èƒŒæ™¯
MarkText å½“å‰æ”¯æŒå¤šç§å›¾ç‰‡ä¸Šä¼ æ–¹å¼ï¼Œä½†å­˜åœ¨ä¸€äº›è¿‡æ—¶çš„ä¸Šä¼ å™¨ï¼ˆå¦‚GitHubä¸Šä¼ å™¨ï¼‰ã€‚éœ€è¦ç§»é™¤å¼ƒç”¨çš„åŠŸèƒ½ï¼Œå¹¶æ·»åŠ å¾®ä¿¡å…¬ä¼—å·å›¾åºŠæ”¯æŒï¼Œæå‡å›¾ç‰‡ä¸Šä¼ çš„å®ç”¨æ€§å’Œç¨³å®šæ€§ã€‚

### 1.2 ç›®æ ‡
- ç§»é™¤å¼ƒç”¨çš„GitHubä¸Šä¼ å™¨
- é›†æˆå¾®ä¿¡å…¬ä¼—å·å›¾åºŠ
- ä¼˜åŒ–å›¾ç‰‡ä¸Šä¼ ä½“éªŒ
- æå‡ä¸Šä¼ æˆåŠŸç‡

## 2. ç”¨æˆ·éœ€æ±‚åˆ†æ

### 2.1 ç”¨æˆ·ç—›ç‚¹
- GitHubä¸Šä¼ å™¨ç»å¸¸å¤±è´¥æˆ–å—é™
- ç¼ºå°‘å›½å†…å¸¸ç”¨çš„å›¾åºŠæ”¯æŒ
- ä¸Šä¼ é…ç½®å¤æ‚
- ä¸Šä¼ è¿›åº¦ä¸æ˜ç¡®

### 2.2 ç”¨æˆ·ä»·å€¼
- æ›´ç¨³å®šçš„å›¾ç‰‡ä¸Šä¼ ä½“éªŒ
- æ”¯æŒå¾®ä¿¡å…¬ä¼—å·ç”Ÿæ€
- ç®€åŒ–çš„é…ç½®æµç¨‹
- æ›´å¥½çš„ä¸Šä¼ åé¦ˆ

## 3. åŠŸèƒ½éœ€æ±‚

### 3.1 æ ¸å¿ƒåŠŸèƒ½

#### 3.1.1 å¾®ä¿¡å…¬ä¼—å·å›¾åºŠé›†æˆ
1. **é…ç½®ç®¡ç†**
   - AppID å’Œ AppSecret é…ç½®ç•Œé¢
   - é…ç½®éªŒè¯å’Œæµ‹è¯•åŠŸèƒ½
   - å®‰å…¨çš„å¯†é’¥å­˜å‚¨

2. **ä¸Šä¼ åŠŸèƒ½**
   - è‡ªåŠ¨è·å–Access Token
   - å›¾ç‰‡ä¸Šä¼ åˆ°å¾®ä¿¡åª’ä½“èµ„æº
   - æ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼
   - ä¸Šä¼ è¿›åº¦æ˜¾ç¤º

3. **è·¯å¾„ç®¡ç†**
   - é»˜è®¤ä¸Šä¼ è·¯å¾„é…ç½® (/marktext)
   - è‡ªå®šä¹‰è·¯å¾„æ”¯æŒ
   - è·¯å¾„å†²çªå¤„ç†

#### 3.1.2 GitHubä¸Šä¼ å™¨ç§»é™¤
1. **æ¸…ç†å·¥ä½œ**
   - ç§»é™¤GitHubç›¸å…³é…ç½®é¡¹
   - æ¸…ç†ç›¸å…³ä»£ç å’Œä¾èµ–
   - æ›´æ–°ç”¨æˆ·ç•Œé¢

2. **è¿‡æ¸¡æ–¹æ¡ˆ**
   - æä¾›æ•°æ®è¿ç§»æç¤º
   - æ›¿ä»£æ–¹æ¡ˆæ¨è

### 3.2 éåŠŸèƒ½éœ€æ±‚
- ä¸Šä¼ æˆåŠŸç‡ > 95%
- å¹³å‡ä¸Šä¼ æ—¶é—´ < 3ç§’
- æ”¯æŒå¹¶å‘ä¸Šä¼ 
- é”™è¯¯å¤„ç†å®Œå–„

## 4. æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 4.1 æŠ€æœ¯æ ˆ
- å¾®ä¿¡å…¬ä¼—å·API
- Node.js HTTPå®¢æˆ·ç«¯
- å›¾ç‰‡å¤„ç†åº“
- é…ç½®ç®¡ç†ç³»ç»Ÿ

### 4.2 å¾®ä¿¡å…¬ä¼—å·APIé›†æˆ

#### 4.2.1 Access Tokenç®¡ç†
```javascript
// è·å–Access Token
const getAccessToken = async (appId, appSecret) => {
  const response = await fetch(`https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=${appId}&secret=${appSecret}`)
  const data = await response.json()
  return data.access_token
}
```

#### 4.2.2 å›¾ç‰‡ä¸Šä¼ 
```javascript
// ä¸Šä¼ å›¾ç‰‡åˆ°å¾®ä¿¡åª’ä½“èµ„æº
const uploadImage = async (accessToken, imageBuffer, filename) => {
  const formData = new FormData()
  formData.append('media', new Blob([imageBuffer]), filename)

  const response = await fetch(`https://api.weixin.qq.com/cgi-bin/media/upload?access_token=${accessToken}&type=image`, {
    method: 'POST',
    body: formData
  })

  const result = await response.json()
  return result
}
```

### 4.3 é…ç½®ç•Œé¢è®¾è®¡

#### 4.3.1 é…ç½®è¡¨å•
- AppID è¾“å…¥æ¡†
- AppSecret å¯†ç æ¡†
- æµ‹è¯•è¿æ¥æŒ‰é’®
- ä¿å­˜é…ç½®æŒ‰é’®

#### 4.3.2 çŠ¶æ€æ˜¾ç¤º
- é…ç½®çŠ¶æ€æŒ‡ç¤ºå™¨
- æœ€åæµ‹è¯•æ—¶é—´
- é”™è¯¯ä¿¡æ¯æ˜¾ç¤º

### 4.4 å®ç°æ­¥éª¤

#### Phase 1: åŸºç¡€æ¶æ„æ­å»º (2å¤©)
1. åˆ›å»ºå¾®ä¿¡APIå®¢æˆ·ç«¯
2. å®ç°Access Tokenç®¡ç†
3. è®¾è®¡é…ç½®å­˜å‚¨æ–¹æ¡ˆ

#### Phase 2: æ ¸å¿ƒåŠŸèƒ½å®ç° (3å¤©)
1. å®ç°å›¾ç‰‡ä¸Šä¼ é€»è¾‘
2. å¼€å‘é…ç½®ç®¡ç†ç•Œé¢
3. é›†æˆé”™è¯¯å¤„ç†æœºåˆ¶

#### Phase 3: æµ‹è¯•å’Œä¼˜åŒ– (2å¤©)
1. åŠŸèƒ½æµ‹è¯•å’Œè¾¹ç•Œæµ‹è¯•
2. æ€§èƒ½ä¼˜åŒ–
3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

## 5. APIè®¾è®¡

### 5.1 é…ç½®ç›¸å…³API
```typescript
interface WeChatConfig {
  appId: string
  appSecret: string
  defaultPath: string
  enabled: boolean
}

interface UploadResult {
  success: boolean
  url?: string
  mediaId?: string
  error?: string
}
```

### 5.2 ä¸Šä¼ æœåŠ¡API
```javascript
// ä¸Šä¼ æœåŠ¡ç±»
class WeChatImageUploader {
  constructor(config: WeChatConfig)

  async testConnection(): Promise<boolean>

  async uploadImage(imageBuffer: Buffer, filename: string): Promise<UploadResult>

  async getMediaUrl(mediaId: string): Promise<string>
}
```

## 6. ç”¨æˆ·ç•Œé¢è®¾è®¡

### 6.1 é…ç½®é¡µé¢
```
â”Œâ”€ å¾®ä¿¡å…¬ä¼—å·å›¾åºŠé…ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AppID:     [____________________]                  â”‚
â”‚ AppSecret: [____________________] [ğŸ‘ï¸]             â”‚
â”‚ é»˜è®¤è·¯å¾„:  [/marktext]                             â”‚
â”‚                                                    â”‚
â”‚ [æµ‹è¯•è¿æ¥] [ä¿å­˜é…ç½®]                              â”‚
â”‚                                                    â”‚
â”‚ çŠ¶æ€: âœ… å·²è¿æ¥ (æœ€åæµ‹è¯•: 2024-01-15 14:30)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ä¸Šä¼ è¿›åº¦
```
ä¸Šä¼ è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 80%
æ­£åœ¨ä¸Šä¼ : screenshot.png
é¢„è®¡å‰©ä½™æ—¶é—´: 2ç§’
```

## 7. å®‰å…¨è€ƒè™‘

### 7.1 å¯†é’¥å®‰å…¨
- AppSecretåŠ å¯†å­˜å‚¨
- å†…å­˜ä¸­çš„ä¸´æ—¶æ¸…ç†
- å®‰å…¨çš„é…ç½®ä¼ è¾“

### 7.2 APIè°ƒç”¨å®‰å…¨
- è¯·æ±‚é¢‘ç‡é™åˆ¶
- é”™è¯¯é‡è¯•æœºåˆ¶
- è¶…æ—¶å¤„ç†

## 8. é£é™©è¯„ä¼°

### 8.1 æŠ€æœ¯é£é™©
- å¾®ä¿¡APIè°ƒç”¨é™åˆ¶
- ç½‘ç»œè¿æ¥é—®é¢˜
- å›¾ç‰‡æ ¼å¼å…¼å®¹æ€§

### 8.2 ä¸šåŠ¡é£é™©
- é…ç½®å¤æ‚æ€§
- ç”¨æˆ·å­¦ä¹ æˆæœ¬
- æœåŠ¡ç¨³å®šæ€§ä¾èµ–

## 9. é‡Œç¨‹ç¢‘è®¡åˆ’

### Week 1: åŸºç¡€æ¶æ„
- [ ] å¾®ä¿¡APIé›†æˆ
- [ ] é…ç½®ç®¡ç†ç³»ç»Ÿ
- [ ] åŸºç¡€ä¸Šä¼ åŠŸèƒ½

### Week 2: åŠŸèƒ½å®Œå–„
- [ ] é”™è¯¯å¤„ç†æœºåˆ¶
- [ ] é…ç½®ç•Œé¢å¼€å‘
- [ ] æµ‹è¯•å’Œè°ƒè¯•

### Week 3: ä¼˜åŒ–å’Œå‘å¸ƒ
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç”¨æˆ·æ–‡æ¡£
- [ ] å‘å¸ƒä¸Šçº¿

## 10. éªŒæ”¶æ ‡å‡†

### 10.1 åŠŸèƒ½éªŒæ”¶
- [ ] å¾®ä¿¡å…¬ä¼—å·é…ç½®æˆåŠŸ
- [ ] å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] é…ç½®ç•Œé¢å‹å¥½

### 10.2 æ€§èƒ½éªŒæ”¶
- [ ] ä¸Šä¼ æˆåŠŸç‡ > 95%
- [ ] å¹³å‡ä¸Šä¼ æ—¶é—´ < 3ç§’
- [ ] æ”¯æŒæœ€å¤§5MBå›¾ç‰‡
- [ ] å¹¶å‘ä¸Šä¼ æ”¯æŒ

### 10.3 ç”¨æˆ·ä½“éªŒéªŒæ”¶
- [ ] é…ç½®æµç¨‹ç®€å•ç›´è§‚
- [ ] ä¸Šä¼ è¿›åº¦æ¸…æ™°å¯è§
- [ ] é”™è¯¯æç¤ºæ˜ç¡®æ˜“æ‡‚
- [ ] ç•Œé¢å“åº”åŠæ—¶
