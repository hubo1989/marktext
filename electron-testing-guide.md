# PicGo 上传器功能测试指南

## 功能改进总结

### 1. 实时检测机制 ✅
- **改进内容**: 替换了原有的手动点击检测方式，实现了自动化的实时检测
- **技术实现**: 使用动态间隔检测，根据检测结果调整检测频率
- **用户体验**: 无需手动操作，系统自动监控 PicGo 状态

### 2. 进入页面立即启动动画 ✅
- **改进内容**: 一进入上传器页面就立即显示加载动画和计时器
- **技术实现**: 在 `startRealtimeDetection` 函数中先启动动画，延迟 3 秒后执行检测
- **用户体验**: 提供即时的视觉反馈，用户知道系统正在工作

### 3. 偏好设置页面实时更新 ✅
- **改进内容**: 修复了页面切换时检测状态不更新的问题
- **技术实现**: 添加了 `onActivated` 和 `onDeactivated` 生命周期钩子
- **用户体验**: 在应用内部页面切换时，检测状态会实时更新

## 测试步骤

### 步骤 1: 启动应用
1. 确保开发服务器正在运行 (`npm run dev`)
2. 打开 Electron 应用
3. 进入 **偏好设置** → **图片** → **上传器**

### 步骤 2: 验证立即启动动画
1. **预期效果**: 一进入页面就能看到蓝色圆点闪烁动画
2. **预期效果**: 同时显示刷新按钮
3. **预期效果**: 3 秒后执行第一次 PicGo 检测
4. **观察要点**: 动画应该立即开始，不需要等待检测结果

### 步骤 3: 验证实时检测机制
1. **观察检测频率**: 
   - 如果 PicGo 可用: 每 30 秒检测一次
   - 如果 PicGo 不可用: 每 5 秒检测一次
2. **观察状态变化**: 检测状态会根据 PicGo 实际状态实时更新
3. **观察动画效果**: 每次检测时都会显示加载动画

### 步骤 4: 验证页面切换更新
1. **切换到其他偏好设置页面** (如主题、编辑器等)
2. **再切换回上传器页面**
3. **预期效果**: 检测状态会重新启动，显示最新的 PicGo 状态
4. **预期效果**: 不需要切换到外部应用就能看到状态更新

### 步骤 5: 验证手动刷新功能
1. **点击刷新按钮**
2. **预期效果**: 立即启动加载动画
3. **预期效果**: 执行 PicGo 检测
4. **预期效果**: 根据检测结果更新状态显示

## 功能特性说明

### 动画效果
- **蓝色圆点闪烁**: 表示正在检测 PicGo 状态
- **动画持续时间**: 检测过程中持续显示
- **动画停止**: 检测完成后自动停止

### 刷新按钮
- **显示时机**: 检测过程中显示
- **隐藏时机**: 检测完成后隐藏
- **点击效果**: 立即重新开始检测流程

### 状态显示
- **PicGo 可用**: 显示绿色成功状态
- **PicGo 不可用**: 显示错误信息和建议
- **检测中**: 显示加载动画和刷新按钮

### 检测频率优化
- **成功状态**: 30 秒检测一次 (降低系统负载)
- **失败状态**: 5 秒检测一次 (快速响应状态变化)
- **手动触发**: 立即执行检测

## 调试信息

### 控制台日志
打开浏览器开发者工具 (F12)，在控制台中可以看到:
- `[PicGo Detector] Starting realtime detection...`
- `[PicGo Detector] Testing PicGo...`
- `[PicGo Detector] PicGo test result: [结果]`
- `[PicGo Detector] Next detection in [时间] seconds`

### 状态监控
- 检测间隔会根据上次检测结果动态调整
- 页面可见性变化会影响检测状态
- 组件激活/失活会重新启动检测

## 故障排查

### 如果动画不显示
1. 检查控制台是否有 JavaScript 错误
2. 确认 `startLoadingAnimation` 函数被正确调用
3. 检查 CSS 动画样式是否正确加载

### 如果检测不工作
1. 检查 PicGo 是否正确安装和配置
2. 查看控制台日志了解检测失败原因
3. 确认网络连接正常

### 如果页面切换不更新
1. 确认 `onActivated` 和 `onDeactivated` 钩子已正确添加
2. 检查组件是否使用了 `<keep-alive>` 包装
3. 查看控制台日志确认钩子函数被调用

## 技术实现细节

### 关键函数
- `startRealtimeDetection()`: 启动实时检测机制
- `startLoadingAnimation()`: 启动加载动画
- `testPicgo()`: 执行 PicGo 检测
- `handleComponentActivated()`: 处理组件激活
- `handleComponentDeactivated()`: 处理组件失活

### 生命周期钩子
- `onMounted`: 组件挂载时启动检测
- `onUnmounted`: 组件卸载时停止检测
- `onActivated`: 组件激活时重新启动检测
- `onDeactivated`: 组件失活时停止检测

### 状态管理
- `isLoading`: 控制加载动画显示
- `showRefreshButton`: 控制刷新按钮显示
- `detectionTimer`: 管理检测定时器
- `animationTimer`: 管理动画定时器

---

**测试完成后，所有功能应该按预期工作，为用户提供流畅的 PicGo 状态监控体验。**