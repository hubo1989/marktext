# 产品需求文档 (PRD) - 源码模式双屏共存功能

## 1. 产品概述

### 1.1 背景
MarkText 支持源码模式和预览模式，但用户在编辑源码时无法同时查看预览效果。需要实现双屏共存模式，让用户可以在源码模式下同时查看源码和预览，提高编辑效率。

### 1.2 目标
- 在源码模式下实现左右分屏显示
- 左侧显示源码编辑器，右侧显示实时预览
- 提供流畅的同步滚动体验
- 支持模式切换和布局调整

## 2. 用户需求分析

### 2.1 用户痛点
- 编辑源码时无法实时查看预览效果
- 需要频繁切换模式来检查格式
- 长文档编辑时定位困难
- Markdown语法检查不便

### 2.2 用户价值
- 提高编辑效率
- 减少模式切换操作
- 实时预览格式效果
- 更好的文档编辑体验

### 2.3 目标用户
- 技术文档写作者
- Markdown重度使用者
- 需要精确控制格式的用户
- 教学和演示场景用户

## 3. 功能需求

### 3.1 核心功能

#### 3.1.1 双屏布局
1. **布局切换**
   - 从单屏源码模式切换到双屏模式
   - 支持水平分屏布局
   - 可调节分屏比例

2. **同步功能**
   - 源码和预览内容实时同步
   - 滚动位置同步
   - 光标位置指示

#### 3.1.2 配置选项
1. **偏好设置**
   - 启用/禁用双屏模式
   - 设置默认分屏比例
   - 配置同步选项

2. **快捷操作**
   - 快速切换双屏模式
   - 重置分屏比例
   - 临时禁用同步

### 3.2 非功能需求
- 响应时间 < 100ms
- 内存占用增加 < 20%
- 支持所有Markdown语法
- 兼容现有主题系统

## 4. 技术实现方案

### 4.1 技术栈
- Vue 3 Composition API
- CSS Grid/Flexbox
- 虚拟滚动优化
- 事件同步机制

### 4.2 架构设计

#### 4.2.1 组件结构
```
DualScreenMode
├── SourcePanel (左侧源码面板)
│   ├── CodeEditor (代码编辑器)
│   └── LineNumbers (行号显示)
├── PreviewPanel (右侧预览面板)
│   ├── MarkdownPreview (Markdown预览)
│   └── ScrollSync (滚动同步)
└── Splitter (分隔条)
    ├── ResizeHandle (调整手柄)
    └── LayoutControls (布局控制)
```

#### 4.2.2 数据流设计
```javascript
// 状态管理
const dualScreenState = reactive({
  enabled: false,           // 是否启用双屏模式
  splitRatio: 0.5,         // 分屏比例 (0-1)
  syncEnabled: true,       // 是否启用同步
  currentLine: 0,          // 当前行号
  scrollTop: 0            // 滚动位置
})

// 事件同步
const syncManager = {
  syncScroll: (source, target) => { /* 滚动同步逻辑 */ },
  syncCursor: (line) => { /* 光标同步逻辑 */ },
  syncContent: (content) => { /* 内容同步逻辑 */ }
}
```

### 4.3 实现步骤

#### Phase 1: 基础架构 (2天)
1. 创建双屏布局组件
2. 实现基本的左右分屏
3. 设置配置存储机制

#### Phase 2: 同步功能 (3天)
1. 实现滚动位置同步
2. 添加光标位置指示
3. 优化内容同步逻辑

#### Phase 3: 用户体验优化 (2天)
1. 添加分屏比例调整
2. 实现快捷操作
3. 性能优化和测试

### 4.4 UI/UX设计

#### 4.4.1 布局设计
```
┌─────────────────┬─────────────────┐
│   Source Code   │   Live Preview  │
│                 │                 │
│ • Line 1        │ # Heading 1     │
│ • Line 2        │                 │
│ • Line 3        │ Some content... │
│ • Line 4        │                 │
│ • Line 5        │ ## Heading 2    │
│   █ (cursor)    │                 │
├─────────────────┼─────────────────┤
│ [Settings] [50%]│ [Settings]      │
└─────────────────┴─────────────────┘
```

#### 4.4.2 交互设计
- 分隔条可拖拽调整比例
- 同步开关按钮
- 快速切换快捷键
- 视觉反馈和动画

## 5. 配置界面设计

### 5.1 偏好设置集成
```
编辑器设置 > 杂项
┌─────────────────────────────────────┐
│ □ 启用源码双屏模式                 │
│                                     │
│ 默认分屏比例: [▭▭▭▭▭●▭▭▭▭▭] 50%  │
│                                     │
│ □ 启用滚动同步                     │
│ □ 启用光标位置指示                 │
│ □ 自动聚焦源码面板                 │
│                                     │
│ 快捷键:                            │
│ 切换双屏模式: Ctrl+Shift+D          │
│ 重置分屏比例: Ctrl+Shift+R          │
└─────────────────────────────────────┘
```

### 5.2 实时配置
```
双屏模式工具栏
┌─────────────────────────────────────┐
│ [🔄] [📏 70%] [⚙️] [✕]             │
└─────────────────────────────────────┘
```

## 6. 性能优化策略

### 6.1 渲染优化
- 使用虚拟滚动处理长文档
- 防抖更新预览内容
- 按需渲染可见区域

### 6.2 内存管理
- 及时清理不需要的DOM节点
- 优化事件监听器管理
- 合理的缓存策略

### 6.3 同步优化
- 节流滚动事件
- 批处理更新操作
- 智能的同步算法

## 7. 测试策略

### 7.1 功能测试
- [ ] 双屏模式切换正常
- [ ] 分屏比例调整正常
- [ ] 内容同步准确
- [ ] 滚动同步流畅

### 7.2 性能测试
- [ ] 长文档渲染时间 < 500ms
- [ ] 内存使用增加 < 20%
- [ ] 滚动同步延迟 < 50ms

### 7.3 兼容性测试
- [ ] 支持所有Markdown语法
- [ ] 兼容现有主题
- [ ] 跨平台兼容性

## 8. 风险评估

### 8.1 技术风险
- 同步算法复杂度
- 性能影响评估
- 浏览器兼容性

### 8.2 用户体验风险
- 学习成本增加
- 界面复杂度提升
- 移动端适配困难

## 9. 里程碑计划

### Week 1: 基础实现
- [ ] 双屏布局组件开发
- [ ] 基本的分屏功能
- [ ] 配置系统集成

### Week 2: 同步功能
- [ ] 滚动同步实现
- [ ] 内容同步优化
- [ ] 性能测试和优化

### Week 3: 用户体验
- [ ] UI/UX完善
- [ ] 快捷操作实现
- [ ] 用户测试和反馈

### Week 4: 发布准备
- [ ] 文档编写
- [ ] 最终测试
- [ ] 发布上线

## 10. 验收标准

### 10.1 功能完整性
- [ ] 双屏模式正常切换
- [ ] 分屏比例可调节
- [ ] 内容实时同步
- [ ] 配置选项完善

### 10.2 性能指标
- [ ] 启动时间 < 200ms
- [ ] 同步延迟 < 100ms
- [ ] 内存使用合理
- [ ] CPU占用正常

### 10.3 用户体验
- [ ] 操作直观简单
- [ ] 视觉效果良好
- [ ] 响应及时流畅
- [ ] 无明显bug

### 10.4 兼容性
- [ ] 支持所有Markdown语法
- [ ] 兼容现有功能
- [ ] 主题系统正常
- [ ] 跨平台兼容

## 11. 后续规划

### 11.1 增强功能
- 垂直分屏模式
- 多文档同时预览
- 自定义布局模板
- 协作编辑支持

### 11.2 数据分析
- 用户使用统计
- 功能使用频率
- 性能监控指标
- 用户反馈收集

### 11.3 持续优化
- 性能持续优化
- 用户体验改进
- 新功能开发
- 生态系统扩展
